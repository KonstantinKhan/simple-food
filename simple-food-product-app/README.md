# Simple Food Product App

Ktor приложение для работы с продуктами питания, реализующее спецификацию OpenAPI `spec-simple-food-api-products.yaml`.

## Описание

Приложение предоставляет RESTful API для управления продуктами питания с полной информацией о пищевой ценности.

## Технологический стек

- **Kotlin** 2.2.20
- **Ktor** 3.3.1
- **Jackson** - сериализация JSON
- **In-memory хранилище** - ConcurrentHashMap

## Архитектура проекта

```
simple-food-product-app/
├── src/main/kotlin/
│   ├── Application.kt              # Главный файл приложения
│   ├── HTTP.kt                     # Настройка HTTP (CORS, ContentNegotiation, Jackson)
│   ├── Routing.kt                  # Настройка роутинга
│   ├── plugins/
│   │   └── StatusPages.kt          # Глобальная обработка ошибок
│   ├── repository/
│   │   ├── ProductRepository.kt    # In-memory репозиторий продуктов
│   │   └── TestData.kt             # Тестовые данные
│   └── routes/
│       └── ProductRoutes.kt        # Роуты для работы с продуктами
└── src/main/resources/
    └── application.conf            # Конфигурация приложения
```

## Зависимости

Приложение использует следующие модули проекта:
- **simple-food-common-models** - бизнес-модели (BeProduct, BeAuthor, BeWeight и т.д.)
- **transport-models** - модели транспортного уровня (сгенерированы из OpenAPI спецификации)
- **transport-mappers** - мапперы для преобразования между бизнес и транспортными моделями

## API Endpoints

### 1. GET /products
Получить список всех продуктов.

**Ответ:** `200 OK` - массив продуктов

### 2. POST /products
Создать новый продукт.

**Тело запроса:** Product (JSON)
**Ответ:** `201 Created` - созданный продукт

### 3. GET /products/{id}
Получить продукт по ID.

**Параметры:** `id` - UUID продукта
**Ответ:** 
- `200 OK` - продукт найден
- `404 Not Found` - продукт не найден
- `400 Bad Request` - неверный формат ID

### 4. PUT /products/{id}
Обновить продукт.

**Параметры:** `id` - UUID продукта
**Тело запроса:** Product (JSON)
**Ответ:**
- `200 OK` - продукт обновлен
- `404 Not Found` - продукт не найден

### 5. DELETE /products/{id}
Удалить продукт.

**Параметры:** `id` - UUID продукта
**Ответ:**
- `204 No Content` - продукт удален
- `404 Not Found` - продукт не найден

### 6. POST /products/search
Поиск продуктов по названию или категориям.

**Тело запроса:** 
```json
{
  "query": "поисковый запрос"
}
```
**Ответ:** `200 OK` - массив найденных продуктов

## Запуск приложения

### Сборка
```bash
./gradlew :simple-food-product-app:build
```

### Запуск
```bash
./gradlew :simple-food-product-app:run
```

Приложение будет доступно по адресу: `http://localhost:8080`

### Тестирование
Для тестирования API используйте скрипт:
```bash
./simple-food-product-app/TEST_COMMANDS.sh
```

## Обработка ошибок

Все ошибки возвращаются в стандартном формате:

```json
{
  "code": "ERROR_CODE",
  "message": "Описание ошибки",
  "details": {}
}
```

### Коды ошибок
- `BAD_REQUEST` - Неверный формат запроса или данных
- `NOT_FOUND` - Ресурс не найден
- `INTERNAL_SERVER_ERROR` - Внутренняя ошибка сервера

## Тестовые данные

При запуске приложения автоматически загружаются 3 тестовых продукта:

1. **Куриная грудка**
   - ID: `550e8400-e29b-41d4-a716-446655440001`
   - Категории: Мясо, Птица, Белковые продукты

2. **Рис белый**
   - ID: `550e8400-e29b-41d4-a716-446655440002`
   - Категории: Крупы, Гарнир, Углеводные продукты

3. **Оливковое масло**
   - ID: `550e8400-e29b-41d4-a716-446655440003`
   - Категории: Масла, Жиры

## Примеры использования

См. файл [API_EXAMPLES.md](API_EXAMPLES.md) для подробных примеров использования API.

## Конфигурация

Файл `application.conf`:
```hocon
ktor {
    deployment {
        port = 8080
        port = ${?PORT}
    }
    application {
        modules = [ com.khan366kos.ApplicationKt.module ]
    }
}
```

## Особенности реализации

1. **Thread-safe хранилище** - использование ConcurrentHashMap для потокобезопасной работы с данными
2. **Глобальная обработка ошибок** - плагин StatusPages для централизованной обработки исключений
3. **Jackson сериализация** - настроена для работы с transport-models
4. **CORS** - настроен для поддержки всех origin'ов (для разработки)
5. **Маппинг моделей** - автоматическое преобразование между business и transport моделями

## Разработка

При добавлении новых endpoints:
1. Обновите `ProductRoutes.kt`
2. Используйте мапперы `.toTransport()` и `.toContext()` для преобразования моделей
3. Обрабатывайте исключения с правильными HTTP статусами
4. Обновите документацию

## Лицензия

Проект разработан в учебных целях.

